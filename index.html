<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mundo Chido ‚Äì Muy pronto</title>
<link rel="icon" href="https://fav.farm/‚ú®" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet" />
<style>
  :root { --gold:#d4af37; }
  *{margin:0;padding:0;box-sizing:border-box;}
  html, body {
    height: 100%;
    overflow: hidden;
  }
  body {
    font-family: 'Poppins', sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    background-color: #f8f8f8;
    color: #111;
    text-align: center;
    animation: fadeIn 1.2s ease forwards;
    opacity: 0;
    height: 100vh;
  }
  @keyframes fadeIn { to {opacity:1;} }

  body::before {
    content: "";
    position: absolute;
    inset: 0;
    background: url("img/fondo.jpg") center/cover no-repeat fixed;
    filter: blur(8px) brightness(1.05);
    z-index: -1;
    transition: .4s;
  }

  main {
    padding: 1rem;
    animation: float 4s ease-in-out infinite;
    z-index: 2;
  }
  h1 {
    font-size: clamp(2.5rem,6vw,3rem);
    font-weight: 700;
  }
  @keyframes float {
    0% {transform: translateY(0);}
    50% {transform: translateY(-8px);}
    100% {transform: translateY(0);}
  }

  #secret {
    position: fixed;
    bottom: 20px;
    right: 25px;
    background: transparent;
    border: none;
    font-size: 2.2rem;
    color: rgba(0,0,0,0.04);
    transition: .3s;
    cursor: pointer;
    z-index: 10;
  }
  #secret:hover {
    color: var(--gold);
    transform: scale(1.2);
    text-shadow: 0 0 10px var(--gold);
  }
  @media (max-width:600px) {
    #secret {
      font-size: 1.8rem;
      right: 15px;
      color: rgba(0,0,0,0.12);
    }
  }

  @keyframes ripple {
    0% {transform: translate(-50%, -50%) scale(.4);opacity:.5;}
    100% {transform: translate(-50%, -50%) scale(10);opacity:0;}
  }
  .ripple {
    position: fixed;
    width: 120px;
    height: 120px;
    border: 2px solid rgba(255,255,255,.3);
    border-radius: 50%;
    pointer-events: none;
    animation: ripple 1.4s cubic-bezier(.4,0,.2,1);
    z-index: 1;
    backdrop-filter: blur(2px);
  }

  /* Modal estilos */
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeOverlay .25s ease forwards;
    z-index: 20;
  }
  @keyframes fadeOverlay {
    from {opacity: 0;}
    to {opacity: 1;}
  }
  .modal {
    background: white;
    padding: 2rem 2.5rem;
    border-radius: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,.15);
    text-align: center;
    max-width: 90%;
    width: 320px;
    position: relative;
    animation: pop .35s cubic-bezier(.4,0,.2,1) forwards;
    transform: scale(.8);
    opacity: 0;
    z-index: 21;
  }
  @keyframes pop {
    to {transform: scale(1); opacity: 1;}
  }
  .modal h2 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 1.2rem;
  }
  .close-btn {
    position: absolute;
    top: 12px;
    right: 14px;
    background: none;
    border: none;
    font-size: 1.3rem;
    cursor: pointer;
    color: #555;
    transition: .2s;
  }
  .close-btn:hover {
    color: #000;
    transform: scale(1.15);
  }
  .modal input {
    width: 100%;
    padding: .6rem 1rem;
    border: 1px solid #ccc;
    border-radius: 10px;
    font-family: inherit;
    margin-bottom: 1rem;
  }
  .modal button.submit {
    background: var(--gold);
    border: none;
    color: #fff;
    padding: .6rem 1.2rem;
    border-radius: 10px;
    font-weight: 700;
    cursor: pointer;
    transition: .2s;
  }
  .modal button.submit:hover {
    filter: brightness(1.1);
  }

  /* Emoji mosquitos */
  .emoji {
    position: absolute;
    font-size: 2.8rem;
    user-select: none;
    cursor: pointer;
    transition: transform .15s ease, opacity .6s ease;
    pointer-events: auto;
  }

  /* Animaci√≥n para el check y cruz */
  .feedback {
    position: fixed;
    font-size: 2.5rem;
    pointer-events: none;
    opacity: 0.85;
    animation: fadeScale 1s forwards;
    z-index: 30;
    user-select: none;
  }
  @keyframes fadeScale {
    0% {opacity: 0.85; transform: translateY(0) scale(1);}
    100% {opacity: 0; transform: translateY(-40px) scale(1.5);}
  }

  #scoreBoard {
    position: fixed;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.1rem;
    font-weight: 700;
    z-index: 22;
    color: white;
    text-shadow: 0 0 6px #000;
    user-select: none;
  }
  #ranking {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.6);
    color: #fff;
    padding: 0.6rem 1rem;
    border-radius: 12px;
    font-size: 0.9rem;
    z-index: 22;
    display: none;
    max-height: 180px;
    width: 320px;
    overflow-y: auto;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<main><h1>Muy pronto... :P</h1></main>
<button id="secret" aria-label="Sorpresa">?</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCQks6syI84wvIIYa_As9ts7Hc5lenN8hk",
    authDomain: "mundochido-ranking.firebaseapp.com",
    projectId: "mundochido-ranking",
    storageBucket: "mundochido-ranking.firebasestorage.app",
    messagingSenderId: "241949692398",
    appId: "1:241949692398:web:0993d30fbddef3f7673eff",
    measurementId: "G-TDYXGHK0TB"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  /* Ripple */
  document.addEventListener("pointerdown",(e)=>{
    const r=document.createElement("span");
    r.className="ripple";
    r.style.left=`${e.clientX}px`;
    r.style.top=`${e.clientY}px`;
    document.body.appendChild(r);
    r.addEventListener("animationend",()=>r.remove());
    handleBurst();
  });

  /* YouTube bot√≥n */
  const ytApp="vnd.youtube:JN2N5HorqSI";
  const ytWeb="https://youtu.be/JN2N5HorqSI?si=4Cuq9r8f856Q_lq0";
  document.getElementById("secret").addEventListener("click",e=>{
    e.stopPropagation();
    new Audio("click.mp3").play().catch(()=>{});
    location.href=ytApp;setTimeout(()=>location.href=ytWeb,800);
  });

  /* Avisos */
  let clicks=0,timer=null,phase=0,modalDone=false;
  const msgs=["PARA UN TOQUE CON LOS CLICKS","DALE LOCO PARAAAAAA","BUENO LISTO HACE LO QUE SE TE CANTA"];
  function handleBurst(){
    if(modalDone) return;
    clicks++;if(!timer)timer=setTimeout(()=>{clicks=0;timer=null;},1500);
    if(clicks>=7){
      clicks=0;clearTimeout(timer);timer=null;
      if(phase<msgs.length){showModal(msgs[phase]);phase++;}
      else{startMosquitoMode();modalDone=true;}
    }
  }

  /* Modal gen√©rico */
  function showModal(text){
    if(document.querySelector(".overlay")) return;
    const ol=document.createElement("div");ol.className="overlay";
    const md=document.createElement("div");md.className="modal";
    const x=document.createElement("button");x.className="close-btn";x.innerHTML="&times;";
    x.onclick=()=>ol.remove();
    const h=document.createElement("h2");h.textContent=text;
    md.append(x,h);ol.append(md);document.body.append(ol);
  }

  /* Modo Mosquito */
  const EMOJIS=["ü™±","ü•¢","üß©","üì°","üü´","ü¶ü"];
  const MOSQUITO = "ü¶ü";

  let active=false, score=0, interval=null, scoreBoard=null, rankingBox=null;
  let fallTime=4000, minFall=1500, speedStep=200; // ms
  let gameEnded=false;
  let lives=3;

  function startMosquitoMode(){
    if(active) return;
    active=true; score=0; fallTime=4000; gameEnded=false; lives=3;
    document.body.style.filter="brightness(.7)";
    scoreBoard=document.createElement("div");
    scoreBoard.id="scoreBoard";
    updateScoreBoard();
    document.body.append(scoreBoard);
    rankingBox=document.createElement("div");
    rankingBox.id="ranking";
    document.body.append(rankingBox);
    interval=setInterval(dropEmoji,700);
  }

  function updateScoreBoard(){
    scoreBoard.innerHTML = `ü¶ü Mosquitos atrapados: ${score} &nbsp;&nbsp;&nbsp; ‚ù§Ô∏è Vidas: ${lives}`;
  }

  function dropEmoji(){
    if(gameEnded) return;
    const e=document.createElement("span");
    e.className="emoji";
    // Elegimos aleatoriamente si es mosquito o no (60% mosquito)
    const isMosquito = Math.random() < 0.6;
    e.textContent = isMosquito ? MOSQUITO : EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
    e.dataset.mosquito = isMosquito ? "1" : "0";
    e.style.left = Math.random()*90 + 5 + "vw";
    e.style.top = "-3rem";
    document.body.append(e);

    const start = performance.now();
    function fall(t){
      const p = (t - start) / fallTime;
      if(p < 1){
        e.style.top = (p * 100) + "vh";
        requestAnimationFrame(fall);
      } else {
        // si el emoji lleg√≥ al piso y es mosquito, pierde una vida
        if(e.dataset.mosquito === "1"){
          loseLife();
        }
        e.remove();
      }
    }
    requestAnimationFrame(fall);

    e.addEventListener("pointerdown", ev => {
      ev.stopPropagation();
      if(gameEnded) return;
      if(e.dataset.mosquito === "1"){
        score++;
        updateScoreBoard();
        showFeedback(e, "‚úÖ");
        e.style.pointerEvents = "none";
        fadeOutAndRemove(e);
        if(fallTime > minFall) fallTime -= speedStep; // acelera
      } else {
        loseLife();
        showFeedback(e, "‚ùå");
        fadeOutAndRemove(e);
      }
    });
  }

  function showFeedback(element, icon){
    const rect = element.getBoundingClientRect();
    const fb = document.createElement("div");
    fb.className = "feedback";
    fb.textContent = icon;
    fb.style.left = (rect.left + rect.width/2) + "px";
    fb.style.top = (rect.top + rect.height/2) + "px";
    document.body.append(fb);
    setTimeout(() => fb.remove(), 1000);
  }

  function fadeOutAndRemove(el){
    el.style.transition = "opacity 0.6s ease, transform 0.6s ease";
    el.style.opacity = "0";
    el.style.transform = "scale(0.7)";
    setTimeout(() => el.remove(), 600);
  }

  function loseLife(){
    if(gameEnded) return;
    lives--;
    updateScoreBoard();
    if(lives <= 0){
      endGame();
    }
  }

  /* Modal para nombre */
  function nameModal(callback){
    if(document.querySelector(".overlay")) return;
    const ol=document.createElement("div");ol.className="overlay";
    const md=document.createElement("div");md.className="modal";
    const x=document.createElement("button");x.className="close-btn";x.innerHTML="&times;";
    x.onclick=()=>{ol.remove();callback(null);};
    const h=document.createElement("h2");h.textContent=`¬°Fin! atrapaste ${score} mosquitos`;
    const input=document.createElement("input");
    input.placeholder="Tu nombre";
    const send=document.createElement("button");
    send.className="submit";
    send.textContent="Aceptar";
    send.onclick=()=>{
      const val = input.value.trim();
      if(val.length === 0){
        alert("Por favor, ingresa tu nombre.");
        input.focus();
        return;
      }
      callback(val);
      ol.remove();
    };
    md.append(x,h,input,send);
    ol.append(md);
    document.body.append(ol);
    input.focus();
  }

  async function endGame(){
    if(gameEnded) return;
    gameEnded = true;
    clearInterval(interval);
    document.querySelectorAll(".emoji").forEach(el=>el.remove());
    document.body.style.filter = "brightness(1)";
    updateScoreBoard();

    nameModal(async name=>{
      if(name){
        try{
          await db.collection("mc_rankings").add({
            name,
            score,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });
        }catch(e){
          alert("Error guardando: " + e.message);
        }
      }
      showRanking();
      active = false;
      gameEnded = false;
      lives = 3;
      fallTime = 4000;
    });
  }

  async function showRanking(){
    if(!rankingBox) return;
    rankingBox.style.display = "block";
    rankingBox.innerHTML = "<strong>RANKING&nbsp;MUNDIAL</strong><br>Cargando...";
    try{
      const snap = await db.collection("mc_rankings").orderBy("score","desc").limit(5).get();
      if(snap.empty){
        rankingBox.innerHTML = "<strong>RANKING&nbsp;MUNDIAL</strong><br>Sin registros.";
        return;
      }
      const list = [];
      snap.forEach(d=>list.push(d.data()));
      rankingBox.innerHTML = "<strong>RANKING&nbsp;MUNDIAL</strong><br>" + list.map((r,i)=>`${i+1}. ${r.name} ‚Äì ${r.score}`).join("<br>");
    }catch(e){
      rankingBox.innerHTML = "Error: " + e.message;
    }
  }
</script>
</body>
</html>
