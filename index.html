<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mundo Chido ‚Äì Muy pronto</title>
  <link rel="icon" href="https://fav.farm/‚ú®" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root { --gold: #d4af37; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; overflow: hidden; font-family: 'Poppins', sans-serif; }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f8f8;
      color: #111;
      text-align: center;
      position: relative;
      animation: fadeIn 1.2s ease forwards;
      opacity: 0;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: url("img/fondo.jpg") center/cover no-repeat fixed;
      filter: blur(8px) brightness(1.05);
      z-index: -1;
    }
    main { padding: 1rem; animation: float 4s ease-in-out infinite; }
    h1 { font-size: clamp(2.5rem, 6vw, 3rem); font-weight: 700; }
    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
    #secret {
      position: fixed;
      bottom: 20px;
      right: 25px;
      background: transparent;
      border: none;
      font-size: 2.2rem;
      color: rgba(0, 0, 0, 0.04);
      transition: 0.3s ease;
      cursor: pointer;
      z-index: 10;
    }
    #secret:hover {
      color: var(--gold);
      transform: scale(1.2);
      text-shadow: 0 0 10px var(--gold);
    }
    @media (max-width: 600px) {
      #secret {
        font-size: 1.8rem;
        right: 15px;
        color: rgba(0, 0, 0, 0.12);
      }
    }
    @keyframes ripple {
      0% { transform: translate(-50%, -50%) scale(0.4); opacity: 0.5; }
      100% { transform: translate(-50%, -50%) scale(10); opacity: 0; }
    }
    .ripple {
      position: fixed;
      width: 120px;
      height: 120px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      pointer-events: none;
      animation: ripple 1.4s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
      backdrop-filter: blur(2px);
      transform: translate(-50%, -50%);
    }
    #mosquitoCanvas {
      position: absolute;
      inset: 0;
      z-index: 5;
      pointer-events: none;
    }
    #rankingToggle {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 1.8rem;
      background: rgba(0, 0, 0, 0.3);
      padding: 4px 8px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 15;
      display: none;
    }
    #rankingPanel {
      position: fixed;
      top: 50px;
      left: 10px;
      width: 180px;
      background: rgba(0, 0, 0, 0.65);
      color: white;
      border-radius: 12px;
      padding: 12px;
      display: none;
      z-index: 15;
    }
    #rankingPanel ul {
      list-style: none;
      padding-left: 0;
      margin-top: 6px;
    }
    #rankingPanel li {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }
    #scoreBoard, #lives {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 10;
      font-size: 1.2rem;
      background: rgba(255, 255, 255, 0.7);
      padding: 6px 12px;
      border-radius: 8px;
      display: none;
    }
    #lives { top: 50px; }
    #modalContainer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 20;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 80%;
      max-width: 320px;
      text-align: center;
    }
    .modal button {
      margin-top: 12px;
      padding: 6px 12px;
      background: black;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Muy pronto... :P</h1>
  </main>
  <button id="secret" aria-label="Sorpresa">?</button>
  <canvas id="mosquitoCanvas"></canvas>
  <div id="rankingToggle">üèÜ</div>
  <div id="rankingPanel"><strong>RANKING MUNDIAL</strong><ul id="rankingList"></ul></div>
  <div id="scoreBoard">Mosquitos atrapados: 0</div>
  <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  <div id="modalContainer"></div>
  <script>
    document.getElementById("secret").addEventListener("click", () => {
      const url = "vnd.youtube://JN2N5HorqSI";
      const fallback = "https://youtu.be/JN2N5HorqSI?si=4Cuq9r8f856Q_lq0";
      const timeout = setTimeout(() => { window.open(fallback, "_blank"); }, 500);
      window.location.href = url;
      setTimeout(() => clearTimeout(timeout), 600);
    });
    document.body.addEventListener("click", (e) => {
      const ripple = document.createElement("div");
      ripple.className = "ripple";
      ripple.style.left = `${e.clientX}px`;
      ripple.style.top = `${e.clientY}px`;
      document.body.appendChild(ripple);
      setTimeout(() => ripple.remove(), 1400);
    });

    // Modo mosquito oculto que se activa tras 4 toques
    let touchCount = 0;
    let warnings = 0;
    document.body.addEventListener("click", () => {
      touchCount++;
      if (touchCount === 5) showWarning("PARA UN TOQUE CON LOS CLICKS");
      if (touchCount === 10) showWarning("DALE LOCO PARAAAAAA");
      if (touchCount === 15) { showWarning("BUENO LISTO HACE LO QUE SE TE CANTA"); startMosquitoGame(); }
    });

    function showWarning(msg) {
      const cont = document.getElementById("modalContainer");
      cont.innerHTML = `<div class="modal"><p>${msg}</p><button onclick="document.getElementById('modalContainer').style.display='none'">X</button></div>`;
      cont.style.display = "flex";
    }

    function startMosquitoGame() {
      const canvas = document.getElementById("mosquitoCanvas");
      const ctx = canvas.getContext("2d");
      const emojiSize = 40;
      const mosquitoes = [];
      const valid = ["ü¶ü"];
      const invalid = ["ü™±", "ü•¢", "üß©", "üì°", "üü´"];
      let score = 0;
      let lives = 3;
      let speed = 1;

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.pointerEvents = "auto";

      document.getElementById("rankingToggle").style.display = "block";
      document.getElementById("scoreBoard").style.display = "block";
      document.getElementById("lives").style.display = "block";

      function spawnEmoji() {
        const isMosquito = Math.random() < 0.7;
        const emoji = isMosquito ? "ü¶ü" : invalid[Math.floor(Math.random()*invalid.length)];
        mosquitoes.push({
          emoji,
          x: Math.random() * (canvas.width - emojiSize),
          y: -emojiSize,
          speed: speed + Math.random()
        });
        if (speed < 5) speed += 0.02;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (const m of mosquitoes) {
          ctx.font = `${emojiSize}px serif`;
          ctx.fillText(m.emoji, m.x, m.y);
          m.y += m.speed;
        }
      }

      function gameLoop() {
        draw();
        for (let i = mosquitoes.length - 1; i >= 0; i--) {
          const m = mosquitoes[i];
          if (m.y > canvas.height) {
            if (m.emoji === "ü¶ü") loseLife();
            mosquitoes.splice(i, 1);
          }
        }
        requestAnimationFrame(gameLoop);
      }

      function loseLife() {
        lives--;
        document.getElementById("lives").innerText = "‚ù§Ô∏è".repeat(lives);
        if (lives <= 0) {
          endGame();
        }
      }

      canvas.addEventListener("click", (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        for (let i = mosquitoes.length - 1; i >= 0; i--) {
          const m = mosquitoes[i];
          const hitX = x >= m.x && x <= m.x + emojiSize;
          const hitY = y >= m.y - emojiSize && y <= m.y;
          if (hitX && hitY) {
            if (m.emoji === "ü¶ü") {
              score++;
              showFeedback("‚úÖ");
            } else {
              loseLife();
              showFeedback("‚ùå");
            }
            mosquitoes.splice(i, 1);
            document.getElementById("scoreBoard").innerText = `Mosquitos atrapados: ${score}`;
            return;
          }
        }
      });

      function showFeedback(symbol) {
        const el = document.createElement("div");
        el.innerText = symbol;
        el.style.position = "fixed";
        el.style.top = "50%";
        el.style.left = "50%";
        el.style.fontSize = "4rem";
        el.style.transform = "translate(-50%, -50%)";
        el.style.opacity = 0.8;
        el.style.transition = "all 0.8s ease";
        document.body.appendChild(el);
        setTimeout(() => { el.style.opacity = 0; el.style.transform = "translate(-50%, -60%)"; }, 0);
        setTimeout(() => el.remove(), 800);
      }

      function endGame() {
        canvas.style.pointerEvents = "none";
        const name = prompt("Perdiste! Tu puntaje: " + score + "\nIngresa tu nombre:");
        if (name) saveScore(name, score);
      }

      function saveScore(name, score) {
        const db = firebase.database();
        db.ref("scores").push({ name, score });
      }

      function loadRanking() {
        const db = firebase.database();
        db.ref("scores").orderByChild("score").limitToLast(5).on("value", (snapshot) => {
          const list = document.getElementById("rankingList");
          list.innerHTML = "";
          const data = [];
          snapshot.forEach(child => data.push(child.val()));
          data.reverse().forEach(entry => {
            const li = document.createElement("li");
            li.textContent = `${entry.name}: ${entry.score}`;
            list.appendChild(li);
          });
        });
      }

      loadRanking();
      setInterval(spawnEmoji, 1000);
      gameLoop();
    }

    document.getElementById("rankingToggle").addEventListener("click", () => {
      const panel = document.getElementById("rankingPanel");
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    });
  </script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQks6syI84wvIIYa_As9ts7Hc5lenN8hk",
      authDomain: "mundochido-ranking.firebaseapp.com",
      databaseURL: "https://mundochido-ranking-default-rtdb.firebaseio.com",
      projectId: "mundochido-ranking",
      storageBucket: "mundochido-ranking.appspot.com",
      messagingSenderId: "241949692398",
      appId: "1:241949692398:web:0993d30fbddef3f7673eff",
      measurementId: "G-TDYXGHK0TB"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</body>
</html>
